--[[
    CROSS-PLACE HOP: LOW POPULATION (MULTI-TRY V2)
    Fitur: 
    - Mengumpulkan banyak server sepi.
    - Jika server pertama gagal (Full/Error), otomatis coba server berikutnya.
    - Tidak berhenti sampai berhasil pindah.
]]

local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local Players = game:GetService("Players")

-- === KONFIGURASI ===
local TargetMap2_ID = 129009554587176 -- GANTI DENGAN ID MAP 2

local function HopToLowPopServer_V2()
    if TargetMap2_ID == 0 then
        warn("‚ö†Ô∏è ID MAP 2 BELUM DIISI!")
        return
    end

    print("üïµÔ∏è Mengumpulkan daftar server sepi...")
    
    -- Ambil daftar server (Ascending = Dari yang paling sepi)
    local url = "https://games.roblox.com/v1/games/" .. TargetMap2_ID .. "/servers/Public?sortOrder=Asc&limit=100"
    
    local success, result = pcall(function()
        return Http:JSONDecode(game:HttpGet(url))
    end)
    
    if success and result and result.data then
        local candidates = {}
        
        -- 1. Kumpulkan semua server yang valid
        for _, server in pairs(result.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId and server.playing > 0 then
                table.insert(candidates, server)
            end
        end
        
        if #candidates == 0 then
            print("‚ùå Tidak ada server sepi ditemukan.")
            return
        end
        
        print("‚úÖ Menemukan " .. #candidates .. " server kandidat.")
        
        -- 2. Coba satu per satu (Looping Try)
        for i, server in ipairs(candidates) do
            print("üîÑ [Percobaan " .. i .. "/" .. #candidates .. "] Mencoba masuk Server ID: " .. server.id)
            print("   Ping: " .. (server.ping or "?") .. " | Players: " .. server.playing)
            
            -- Coba Teleport
            TPS:TeleportToPlaceInstance(TargetMap2_ID, server.id, Players.LocalPlayer)
            
            -- 3. Mekanisme Tunggu & Cek
            -- Kita tunggu 8 detik. Jika teleport berhasil, script akan mati sendiri (karena game close).
            -- Jika setelah 8 detik script masih jalan, berarti TELEPORT GAGAL (Kena kick/full).
            task.wait(8)
            
            print("‚ö†Ô∏è Gagal masuk (Server Full/Error). Mencoba kandidat berikutnya...")
        end
        
    else
        warn("‚ùå Gagal mengambil data API.")
    end
end

-- Eksekusi
HopToLowPopServer_V2()
